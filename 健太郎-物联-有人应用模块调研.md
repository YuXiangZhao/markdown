[TOC]



# 健太郎-物联-有人WIFI应用模块调研

# 1.入手初级测试

### 1.1.硬件连接

为了测试RS232/RS485 到WIFI/以太网的通讯转换，我们将USR-WIFI232-610 串口服务器的串口与计算机的串口连接，串口服务器的WIFI 和计算机的WIFI 连接。台式机如果没有自带串口，也可以用USB 转232 先来替代。硬件连接如下图：

![1212](C:\Users\dzhang\Pictures\1212.PNG)

只需根据标签指示将天线、供电和RS232 线接到串口服务器的接口上即可。

### 1.2.网络连接

打开无线网络连接，搜索网络，如下图的“USR-WIFI232-610_xxxx”(xxxx 为MAC 地址后四位)即是WIFI串口服务器的的默认网络名称(SSID)。

加入网络，选择自动获取IP，USR-WIFI232-610 串口服务器支持DHCP Server 功能并默认开启。

![1213](C:\Users\dzhang\Pictures\1213.PNG)

此时，WIFI 串口服务器上的Link 指示灯亮起。

### 1.3.数据传输测试

WIFI 串口服务器的初始参数：

- WIFI 串口服务器默认的SSID 为：USR-WIFI232-610_xxxx；(xxxx 是WIFI 串口服务器MAC 的后四位)
- WIFI 串口服务器加密方式默认为：open，none；
- 用户串口参数默认为：57600,8,1,None；
- 网络参数默认值：TCP,Server,8899,10.10.100.254；
- WIFI 串口服务器本身IP 地址：10.10.100.254



只需要按照参数相应设置网络通信参数，就可以进行串口与WIFI 的双向通信了，操作步骤如下：

- 打开测试软件“USR-TCP232-Test.exe”,串口连接到的计算机的串口号COM5（根据具体情况选择），选择WIFI 串口服务器串口默认波特率57600，点打开串口。


- 网络设置区选择TCP Client 模式，服务器IP 地址输入10.10.100.254，此为WIFI 串口服务器默认的IP 地址，服务器端口号8899，此为WIFI 串口服务器默认监听的TCP 端口号，点击连接建立TCP 连接。

具体演示如下图所示：
![1214](C:\Users\dzhang\Pictures\1214.PNG)

- 串口到网络的数据流向是：计算机串口->模块串口->模块WIFI->计算机网络
- 网络到串口的数据流向是：计算机网络->模块WIFI->模块串口->计算机串口



# 2.设备常用方法

- AP 模式：Access Point，提供无线接入服务，允许其它无线设备接入，提供数据访问，无线路由/网桥工作在该模式下。


- STA 模式： Station, 类似于无线终端，sta 本身并不接受无线的接入，它可以连接到AP，无线网卡即工作在该模式。


- TCP Server：TCP 侦听、等待网络客户端连接。与WIFI 的AP 模式类似，本身不主动连接，而是等待TCPClient 建立连接。


- TCP Client：为TCP 网络服务提供客户端连接。与WIFI 的STA 模式类似，主动去向TCP Server 建立连接。

  ​

  WIFI 的AP 与STA 和TCP 的Server 与Client 没有必然的联系。AP 的模块可以作为TCP Server 也可以作为TCP Client；同样STA 模块也既可以作为TCP Server 也可以作为TCP Client。

但是双方要通信，必须STA 连上AP，TCP Client 连上TCP Server。

### 2.1.模块作为AP+TCP  Server

本应用适用于：没有无线路由器的情况下，模块充当无线路由器，并且有多台电脑跟一个串口设备进行通信的情况。
初步测试就是用的这个方式。

### 2.2.模块作为AP+TCP Client 

本应用适用于：没有无线路由器的情况下，模块充当无线路由器，并且由一台电脑作为TCP Server 跟串口设备进行通信的情况。

这种应用的具体操作步骤如下：

#### 2.2.1.硬件及网络连接

网络连接和硬件连接部分同入手初级测试。

#### 2.2.2.模块参数设置

- “网络连接详细信息”可知电脑的IP 是“10.10.100.100”

- 接下来打开电脑的浏览器，在浏览器的地址栏中输入“10.10.100.254”进入模块的内置网页

- 进入模块的内置网页时会让输入用户名和密码，此处默认的用户名和密码都是“admin”

- 进入模块的内置网页后页面如下图。点击首页“网络配置”的“修改”

- 然后将网络模式改为“Client”、协议改为“TCP”、端口“8899”、服务器地址“10.10.100.100”

  （服务器地址应为电脑的IP）

- 接下来点击“确定”、“重启”具体页面如下

- 完成后，等待模块重启，并让电脑重新连接到模块的无线网络中。

![1219](C:\Users\dzhang\Pictures\1219.png)

#### 2.2.3.数据收发测试

- 打开测试软件USR-TCP232-Test.exe ,选择硬件连接到的计算机的串口号，这里是COM3，选择波特率57600，此为WIFI 模块内部串口默认的波特率，点“打开串口”。


- 网络设置区选择TCP Server 模式，本地IP 地址（“网络连接详细信息”得到的IP）不用修改，服务器端口号8899,此处跟模块内部填写的端口号相同即可，点击“开始监听”。等待一会，模块的TCP Client

就连接上来了，接下来就可以进行串口跟网络的数据传输了。

![1220](C:\Users\dzhang\Pictures\1220.PNG)

### 2.3.模块作为STA+TCP Server

本应用适用于：有无线路由器的情况下，模块作为无线网卡加入到路由器中，并且模块作为TCP Server，一台电脑作为TCP Client 跟串口设备进行通信的情况。这种情况下，PC 可以在上网的同时，还能跟串口设备通信，并且可以多个PC 跟串口设备通信。

这种应用的具体操作步骤如下：

#### 2.3.1.硬件及网络连接

网络连接和硬件连接部分同入手初级测试。

#### 2.3.2.模块参数设置

- “网络连接详细信息”可知电脑的IP 是“10.10.100.100”
- 接下来打开电脑的浏览器，在浏览器的地址栏中输入“10.10.100.254”进入模块的内置网页
- 进入模块的内置网页时会让输入用户名和密码，此处默认的用户名和密码都是“admin”
- 进入模块的内置网页后页面如下图。点击首页“无线配置”的“修改”
- 然后将工作模式改为“STA 模式”，点击下面的“搜索”
- 在跳出的新的页面中选择要加入的路由器，并点击“Apply”。具体过程如下图
- 回到首页后，填写“密码”，都完成后，点击“确定”。最后点击“重启”。

![1221](C:\Users\dzhang\Pictures\1221.png)

![1222](C:\Users\dzhang\Pictures\1222.PNG)

![1223](C:\Users\dzhang\Pictures\1223.png)

#### 2.3.3.查看模块的IP

查看模块在路由器获取到的IP，有三种方式：路由器查看、局域网搜索、AT 指令查看。

- 路由器查看：登陆模块加入的路由器的内置网页，在DHCP 服务器->客户端列表中就可以找到。
- 局域网搜索：搜索软件，利用专用软件搜索局域网内的有人公司的模块（前提：PC 和模块在同一个局域网“同一个路由器”下）

![1230](C:\Users\dzhang\Pictures\1230.png)

- AT 指令查看：用专用软件，确定电脑跟模块的串口已经连接好了，在软件的串口参数区域选择COM 口，波特率是57600。点击“+++a”，等待操作日志栏中返回“a+ok”，接下来在AT指令输入框内写入“AT+WANN”，并点击“发送命令”。



#### 2.3.4.数据收发测试

- 打开测试软件USR-TCP232-Test.exe ,选择硬件连接到的计算机的串口号，这里是COM3，选择波特率57600，此为WIFI 模块内部串口默认的波特率，点“打开串口”。


- 网络设置区选择TCP Cilint 模式，服务器地址写上面看到的“192.168.0.113”，服务器端口号8899,此处跟模块内部填写的端口号相同即可，点击“连接”。等待连接成功，接下来就可以进行串口跟网络的数据传输了。

![1224](C:\Users\dzhang\Pictures\1224.png)



### 2.4.模块作为STA+TCP Client

本应用适用于：有无线路由器的情况下，模块作为无线网卡加入到路由器中，并且模块作为TCP Client，一台电脑作为TCP Server 跟串口设备进行通信的情况。这种情况是最常用的方式，TCP Server 也可以是公网的服务器。

这种应用的具体操作步骤如下：

#### 2.4.1.硬件及网络连接

网络连接和硬件连接部分同入手初级测试。

#### 2.4.2.模块参数设置

- “网络连接详细信息”可知电脑的IP 是“10.10.100.100”
- 接下来打开电脑的浏览器，在浏览器的地址栏中输入“10.10.100.254”进入模块的内置网页
- 进入模块的内置网页时会让输入用户名和密码，此处默认的用户名和密码都是“admin”
- 进入模块的内置网页后页面如下图。点击首页“无线配置”的“修改”
- 然后将工作模式改为“STA 模式”，点击下面的“搜索”
- 在跳出的新的页面中选择要加入的路由器，并点击“Apply”。具体过程如下图
- 回到首页后，填写“密码”，都完成后，点击“确定”。

![1221](C:\Users\dzhang\Pictures\1221.png)

![1222](C:\Users\dzhang\Pictures\1222.PNG)

![1223](C:\Users\dzhang\Pictures\1223.png)

- 接下来设置TCP client，首先要先确定电脑的IP，上文中提到过，此处不再赘述了，本处为“192.168.0.142”。
- 点击首页“网络配置”的“修改”，然后将网络模式改为“Client”、协议改为“TCP”、端口“8899”、服务器地址“192.168.0.142”（服务器地址应为电脑的IP，上文中看到的IP）。接下来点击“确定”、“重启”具体页面如下：
- 完成后，等待模块重启，并让电脑重新连接到模块的无线网络中。

![1225](C:\Users\dzhang\Pictures\1225.png)

#### 2.4.3.数据收发测试

- 打开测试软件USR-TCP232-Test.exe ,选择硬件连接到的计算机的串口号，这里是COM3，选择波特率57600，此为WIFI 模块内部串口默认的波特率，点“打开串口”。
- 网络设置区选择TCP Server 模式，本地IP 地址不用修改，服务器端口号8899,此处跟模块内部填写的端口号相同即可，点击“开始监听”。等待一会，模块的TCP Client 就连接上来了，接下来就可以进行串口跟网络的数据传输了。

![1226](C:\Users\dzhang\Pictures\1226.png)

### 2.5.WIFI模块配合虚拟串口

- 等电脑连上模块的wifi 网络后， 在虚拟串口软件的主页面上点击“ 搜索”， 在下拉菜单中选择“USR-WIFI232-X”。
- 在弹出的搜索列表对话框中，点击“搜索设备”，在设备列表中，选择搜索到的设备，并点击“连接虚拟串口”。
- 点击后会弹出对话框，选择“确定”即可，这样在主页的列表中就会有一个建立好的虚拟串口。

![1229](C:\Users\dzhang\Pictures\1229.png)

打开两个USR-TCP232-Test.exe 软件，一个用真实的串口COM 1，一个用虚拟的串口COM 2，这两个之间接可以相互通信了，表面上COM2 是一个串口，但是实际上COM2 是将一个TCP 连接虚拟成了一个串口。

这样的通信时间的回路是这样的：COM 2->虚拟串口-> WIFI->模块->模块的串口->232 串口线->COM 1。



# 3.产品组网应用方案

USR-WIFI232-610 串口服务器既可以配置成一个无线STA，也可以配置成AP。所以USR-WIFI232-610 逻
辑上支持2 个无线接口，一个作为STA，另一个接口相当于一个AP，其它STA 可以通过这个串口服务器的AP
接口连入无线网络。

同时，USR-WIFI232-610 串口服务器提供一个100M 以太网接口，通过这个100M 以太网
接口，用户可以实现WIFI、串口、以太网口，三个接口互通。在组网方面，USR-WIFI232-610 串口服务器支持
桥接模式和路由模式来对应不同的具体应用。

### 3.1.无线组网配置

相关AT 命令如下：

无线组网AT命令列表：

|      | 项目     | 说明                         |
| ---- | ------ | -------------------------- |
| 1    | WMODE  | 设置/查询WIFI 操作模式（AP、STA）     |
| 2    | WSSSID | 设置/查询关联AP 的SSID            |
| 3    | WSKEY  | 设置/查询WIFI STA 模式下的加密参数     |
| 4    | WANN   | 设置/查询STA 的网络参数             |
| 5    | WSLK   | 查询STA 的无线连接状态              |
| 6    | WAP    | 设置/查询WIFI AP 模式下的参数        |
| 7    | WAKEY  | 设置/查询WIFI AP 模式下的加密参数      |
| 8    | LANN   | 设置/查询模块AP 模式下IP            |
| 9    | FAPSTA | 使能/禁用模块AP+STA 模式（仅支持AT 命令） |



socket 相关AT 命令列表：

|      | 项目      | 说明                |
| ---- | ------- | ----------------- |
| 1    | NETP    | 设置/查询TCPA 的网络协议参数 |
| 2    | TCPB    | 使能/禁用TCPB 功能      |
| 3    | TCPPTB  | 设置/查询TCPB 的端口号    |
| 4    | TCPADDB | 设置/查询TCPB 的服务器    |



网页配置，通过浏览器打开http://10.10.100.254/ ：

![1215](C:\Users\dzhang\Pictures\1215.PNG)

### 3.2.无线组网应用

**无线组网应用（AP）**

WIFI 串口服务器作为一个AP 使用，其它WIFI 串口服务器及电脑都可以作为STA 连到这个WIFI 串口服
务器上，同时它也可以通过RS232/RS485 接口连到用户设备，如下图所示：

![1216](C:\Users\dzhang\Pictures\1216.PNG)

**无线组网应用（STA）**

USR-WIFI232-610 串口服务器作为STA 连接到其它AP（如局域网中的路由）上，组成一个无线网络。所
有的STA 都以该AP 作为无线网络的中心，STA 之间的相互通信都通过AP 转发完成，如下图所示:

![1217](C:\Users\dzhang\Pictures\1217.PNG)

**无线组网应用（AP+STA）**

USR-WIFI232-610 串口服务器可同时支持一个AP 接口，一个STA 接口。开启AP+STA 功能后，STA 和
AP 接口同时可用。串口服务器的STA 接口与路由器相连，并通过TCPB 与网络中的服务器相连；同时AP 接
口可以被手机/PAD 等连接（通过TCPA 连接）。如此，网络中的服务器TCP Server、手机/PAD 等都可以对
USR-WIFI232-610 串口服务器所连接串口设备进行控制或者对串口服务器本身参数进行设置，如下图所示：

![1218](C:\Users\dzhang\Pictures\1218.PNG)

- 通过AP+STA 功能，可以很方便的利用手机/PAD 等手执设备对用户设备进行监控。
- 通过AP+STA 功能可以很方便的对串口服务器进行设置，解决串口服务器在STA 时只能通过串口进

行设置的问题。

### 3.3.有线组网应用

有线组网应用（AP LAN）

USR-WIFI232-610 作为AP 使用时，其它电脑或设备都可以作为STA 通过RJ45（即网线）和无线的方式连到这个串口服务器上，以串口服务器为中心组成一个网络，网络中所有设备的IP 地址与串口服务器工作在同一个网段，可以互通。

有线组网应用（AP WAN）

USR-WIFI232-610 串口服务器做为AP，以太网接口设置为WAN 口，连接至可上外网的路由上，开启DHCP服务器功能，此时串口服务器作为二级路由器使用，PC 或者其他智能手持设备连接串口服务器AP 即可上网，此时串口服务器默认AP 通常为USR-WIFI232-610_xxxx，无加密，可以通过网页或AT 命令进行设置。

串口服务器连到AP 后，从AP 处获得IP 地址（如图192.168.1.10）。串口服务器本身组成一个子网（默认10.10.100.254），以太网接口上的设备由串口服务器分配地址。

有线组网应用（路由）

USR-WIFI232-610 串口服务器作为STA（软件为N-Ver），工作在路由模式。连到AP 后，从AP 处获得IP地址（如图192.168.1.101）。串口服务器本身组成一个子网（默认10.10.100.254），以太网接口上的设备由串口服务器分配地址（如图10.10.100.101）。这样如图PC1 处于子网内（NAT），所以从PC1 发起连接，可以连到PC2 （因为USR-WIFI232-610 工作在路由模式），但PC2 不能主动连接到PC1。

有线组网应用（桥接）

USR-WIFI232-610 串口服务器做为STA（软件为Z-Ver），工作在桥接模式。连到AP 后，以太网接口上的设备会从AP 处获得IP 地址（如图192.168.1.101）。此时整个网络，串口服务器如同一个透明的设备，PC1、PC2之间可以互通，而不受任何约束。但是USR-WIFI232-610 串口服务器如果要与其它设备互通，需要静态设置LAN IP 地址（如图192.168.1.10）。

# 4.产品功能

### 4.1.工作模式

WIFI 串口服务器共有四种工作模式：

- 透明传输
- 串口指令模式
- HTTPD Client 模式
- AT 命令模式

#### 4.1.1.透明传输模式

WIFI 串口服务器支持串口透明传输模式，在该模式下，有需要收发的数据都被在串口与WIFI/以太网之间做透明传输，不做任何解析，实现通用串口设备与网络设备之间的数据传递。

在透明传输模式下，可以完全兼容用户原有的软件平台。用户设备基本不用做软件改动就可以实现支持无线数据传输，如下图：

![1227](C:\Users\dzhang\Pictures\1227.png)

#### 4.1.2.串口指令模式

在该模式下，用户可以按照我们的协议发送数据给服务器，无需重启即可向不同的服务器发送数据。

在此模式下，当USR-WIFI232-610 串口服务器作UDP Client 或TCP Client 时，允许用户将串口的数据发往不同的服务器端，而不受Socket 数量的限制。

客户的MCU 只需要按照我司规定的格式发送数据包，串口服务器会解析收到的数据，如果数据符合协议，串口服务器会将解析后的数据发送到指定的服务器端；如果数据不符合协议，则作为废包处理掉，而不会将其发向服务器端。

注意：串口指令模式为一种数据透传模式，请注意与可以查询或设置串口服务器参数的AT 命令模式加以区分！

#### 4.1.3.HTTPD Client模式

在该模式下，用户可以发送的数据到指定HTTP 服务器，而WIFI 串口服务器会自动在所发送数据的前面加上HTTP 协议头，具体协议头的内容可以通过AT 指令或是网页设置。

此模式用于WIFI 串口服务器将数据传向HTTP 服务器端，或者是从HTTP 服务器端获取数据。用户在用AT 命令或是网页设置好HTTP 报头的具体内容后。每次发送数据时，WIFI 串口服务器会自动将所发送的数据封装成HTTP 协议数据，发送到指定HTTP 服务器上。而从服务器接收到数据会直接传输到串口，不做任何处
理。繁琐的HTTP 协议由WIFI 串口服务器来做，方便用户进行串口的编程，而不用去考虑过多的HTTP 的事情。

![1228](C:\Users\dzhang\Pictures\1228.png)

HTTPD Client 指令列表

| 序号   | 命令      | 说明                              |
| ---- | ------- | ------------------------------- |
| 1    | HTPMODE | 新、旧版HTTP 报头设置方式切换（HTTPD Client） |
| 2    | HTTPURL | 旧版设置/查询HTTP 服务器的IP 和端口          |
| 3    | HTTPTP  | 旧版设置/查询HTTP 请求类型                |
| 4    | HTTPPH  | 旧版设置/查询HTTP 协议头路径               |
| 5    | HTTPCN  | 旧版设置/查询HTTP 协议头Connection       |
| 6    | HTTPUA  | 旧版设置/查询HTTP 协议头User-Agent       |
| 7    | HTPSV   | 新版设置/查询服务器地址和IP（HTTPD Client）   |
| 8    | HTPTP   | 新版设置/查询请求方式（HTTPD Client）       |
| 9    | HTPURL  | 新版设置/查询请求路径（HTTPD Client）       |
| 10   | HTPHEAD | 新版设置/查询HTTP 报头（HTTPD Client）    |



### 4.2.socket 通信

USR-WIFI232-610 串口服务器有两个Socket：Socket A 和Socket B。向USR-WIFI232-610 串口写入的数据，USR-WIFI232-610 会自动向Socket A 和B 同时发送；USR-WIFI232-610 通过Socket A 或Socket B 接收的数据，都通过串口发送出来。

Socket A 的工作方式包括：TCP Server、TCP Client、UDP Server、UDP Client。目前Socket B 只支持TCP client（用户可将Socket B 连接远程服务器，实现设备的远程控制）。通过对双Socket 的不同设定，可以实现多种网络互连方式。

USR-WIFI232-610 串口服务器有两个TCP Socket：Socket A 和Socket B。向WIFI 串口服务器串口写入的数据，WIFI 串口服务器会自动向Socket A 和B 同时发送；WIFI 串口服务器通过Socket A 或B 接收的数据，都通过串口发送出来。

Socket A 的工作方式包括：TCP Server、TCP Client、UDP Server、UDP Client。目前Socket B 只支持TCP client（用户可将Socket B 连接远程服务器，实现设备的远程控制）。通过对双Socket 的不同设定，可以实现多种网络互连方式。

当Socket A 设置成TCP Server 时，可支持最多达到32 个TCP Client 的TCP 链路连接。

### 4.3.注册ID/MAC/CLOUD

此功能只适用于WIFI 串口服务器作为TCP Client 的时候。

注册ID/MAC 功能是当WIFI 串口服务器连上服务器时会在数据的前面带有两个字节的ID 号（ID 范围是0~65535，高字节在前，低字节在后）加两个字节的ID 反码或者是上传6 个字节的MAC 地址。例如WIFI 串口服务器默认的ID 是1111（MAC 地址：D8B04CF20000）,则发向服务器时前四个字节为“0x04 0x57 0xFB 0xA8”（或者是0xD8 0xB0 0x4C 0xF2 0x00 0x00）。

注册CLOUD（透传云）功能是当WIFI 串口服务器连接上服务器时，发送由设备ID 和通信密码组成的注册包，注册包信息正确，服务器返回注册成功信息，WIFI 串口服务器接入透传云平台，有关透传云的详情请登录：http://cloud.usr.cn。

注册USR（用户自定义注册包）功能允许用户自定义注册包内容，长度限制在40 字符以内（UDP Client方式下支持，每次发送数据包前增加用户自定义注册包）。

注册ID/MAC/USR 功能有两种注册方式：一种是首次连接服务器时注册自身的ID/MAC；另一种是每次发送的数据的前面加上ID/MAC。

注册CLOUD 只有一种注册方式，即当连接到服务器时发送加入透传云的注册包。

### 4.4.web socket 功能

本WIFI 串口服务器实现websocket server 的功能。可以让WIFI 串口服务器的串口跟网页进行实时交互，取代早先的HTTP GET、POST、PUT 的方式，相应速度更快。本WIFI 串口服务器提供相应的websocket 测试网页，供用户测试，具体页面如下图：（该网页的地址为10.10.100.254/websocket.html）

### 4.5.固件升级

USR-WIFI232-610 串口服务器支持web 方式的在线固件升级

首先用PC 的无线网卡连接USR-WIFI232-610，SSID 为USR-WIFI232-610_xxxx。等连接好后，打开IE，在地址栏输入http://10.10.100.254，回车。在弹出来的对话框中填入用户名和密码（默认均为admin），然后“确认”

进入USR-WIFI232-610 的内置网页，在“模块管理”页面下的“软件升级”项用于实现web 方式的固件升级

通过单击“选择文件”选择要升级的固件，单击“确定”后会弹出确认窗口，再次单击“确定”后，开始固件升级



# 5.相关下载

**要下载的软件**

　　说明书：[http://www.usr.cn/Download/189.html](http://www.usr.cn/Download/189.html)

　　设置软件：[http://www.usr.cn/Download/91.html](http://www.usr.cn/Download/91.html)

　　测试软件：[http://www.usr.cn/Download/27.html](http://www.usr.cn/Download/27.html)

　　虚拟串口软件：[http://www.usr.cn/Download/31.html](http://www.usr.cn/Download/31.html)



